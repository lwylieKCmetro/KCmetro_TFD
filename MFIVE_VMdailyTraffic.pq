let
  Source = Sql.Database("kcitazrsqlprp01.database.windows.net", "tbird_dw", [Query = "--Daily headcount per location from MFIVE KC Vehicle Maintenance#(lf)declare @today datetime#(lf)set @today = getdate()#(lf)select#(lf)#(tab)count(DISTINCT lbrchg.EMP_ID) AS HEADCOUNT,#(lf)#(tab)--Dwell time to infer facility usage#(lf)#(tab)sum(datediff(hh,lbrchg.START_TIME,lbrchg.END_TIME)) AS 'DWELL_TIME',#(lf)#(tab)--lbrchg.LOCATION AS MFIVE_LOCATION,#(lf)#(tab)CASE#(lf)#(tab)#(tab)WHEN lbrchg.LOCATION = 'SB' THEN 'SBVM'#(lf)#(tab)#(tab)WHEN lbrchg.LOCATION = 'BB' THEN 'BBVM'#(lf)#(tab)#(tab)WHEN lbrchg.LOCATION = 'EB' THEN 'EBVM'#(lf)#(tab)#(tab)WHEN lbrchg.LOCATION = 'CB' THEN 'CBVM'#(lf)#(tab)#(tab)WHEN lbrchg.LOCATION = 'AB' THEN 'ABVM'#(lf)#(tab)#(tab)WHEN lbrchg.LOCATION = 'NB' THEN 'NBVM'#(lf)#(tab)#(tab)WHEN lbrchg.LOCATION = 'NRV' THEN 'CNRV'#(lf)#(tab)#(tab)WHEN lbrchg.LOCATION = 'RB' THEN 'RBVM'#(lf)#(tab)#(tab)WHEN lbrchg.LOCATION = 'MO' THEN 'MTOB'#(lf)#(tab)#(tab)ELSE lbrchg.LOCATION#(lf)#(tab)END AS EAM_LOCATION,#(lf)#(tab)locgen.NAME,#(lf)#(tab)locgen.ADDRESS,#(lf)#(tab)CONVERT(DATE,lbrchg.START_TIME) AS 'WORK_DATE',#(lf)#(tab)--CAST(lbrchg.START_TIME AS DATE) AS 'WORK_DATE',#(lf)#(tab)scdshf.DESCRIPTION AS 'SHIFT'#(lf)from MFIVE.ACC_LAB_CHG lbrchg#(lf)LEFT OUTER JOIN [MFIVE].[SCHED_SHIFT] scdshf ON lbrchg.[SHIFT_CODE]=scdshf.SCHED_SHIFT#(lf)LEFT OUTER JOIN [MFIVE].[LOC_GEN] locgen ON lbrchg.LOCATION=locgen.LOCATION#(lf)--WHERE lbrchg.START_TIME >= @TODAY-3#(lf)WHERE lbrchg.START_TIME >= '2017/1/1'#(lf)GROUP BY CONVERT(DATE,lbrchg.START_TIME),scdshf.DESCRIPTION,lbrchg.LOCATION,locgen.NAME,locgen.ADDRESS#(lf)ORDER BY CONVERT(DATE,lbrchg.START_TIME) DESC#(lf);"]),
  #"Changed column type" = Table.TransformColumnTypes(Source, {{"WORK_DATE", type date}})
in
  #"Changed column type"
